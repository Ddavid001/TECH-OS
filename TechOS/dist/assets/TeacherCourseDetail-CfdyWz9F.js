import{c as H,a as L,b as B,r as l,w as g,j as e,s as k,x as O,u as $}from"./index-Craug-YI.js";import{B as w}from"./button-D5YUjWo4.js";import{C,a as E,b as D,c as T,d as F}from"./card-cHz5kV7I.js";import{S as M}from"./skeleton-DXrWeBCp.js";import{D as I,b as P,c as W,d as R,e as V,T as Y}from"./dialog-DRmWnZW-.js";import{I as Z}from"./input-Be_K3n5P.js";import{A as G}from"./arrow-left-6NE5Qxv-.js";import{B as U}from"./book-open-CtZhBFJg.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q=H("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z=H("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),J=({open:n,onOpenChange:b,scheduleId:d,courseName:r,dayName:_})=>{const{user:h}=L(),{toast:o}=B(),[u,y]=l.useState([]),[f,N]=l.useState(!1),[p,j]=l.useState(!1),[c,v]=l.useState(null);l.useEffect(()=>{n&&x()},[n,d]);const x=async()=>{N(!0);try{const{data:a,error:t}=await g.from("class_materials").select("*").eq("schedule_id",d).order("created_at",{ascending:!1});if(t)throw t;y(a||[])}catch(a){console.error("Error fetching materials:",a),o({title:"Error",description:"Failed to load materials",variant:"destructive"})}finally{N(!1)}},s=a=>{a.target.files&&a.target.files[0]&&v(a.target.files[0])},i=async()=>{if(!(!c||!h)){j(!0);try{const a=`${d}/${Date.now()}_${c.name}`,{error:t}=await k.storage.from("class-materials").upload(a,c);if(t)throw t;const{error:m}=await g.from("class_materials").insert({schedule_id:d,file_name:c.name,file_path:a,uploaded_by:h.id});if(m)throw m;o({title:"Success",description:"Material uploaded successfully"}),v(null),x()}catch(a){console.error("Error uploading material:",a),o({title:"Error",description:"Failed to upload material",variant:"destructive"})}finally{j(!1)}}},S=async a=>{try{const{error:t}=await k.storage.from("class-materials").remove([a.file_path]);if(t)throw t;const{error:m}=await g.from("class_materials").delete().eq("id",a.id);if(m)throw m;o({title:"Success",description:"Material deleted successfully"}),x()}catch(t){console.error("Error deleting material:",t),o({title:"Error",description:"Failed to delete material",variant:"destructive"})}};return e.jsx(I,{open:n,onOpenChange:b,children:e.jsxs(P,{className:"max-w-2xl",children:[e.jsxs(W,{children:[e.jsx(R,{children:"Manage Materials"}),e.jsxs(V,{children:[r," - ",_]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Z,{type:"file",onChange:s,disabled:p}),e.jsxs(w,{onClick:i,disabled:!c||p,children:[e.jsx(z,{className:"h-4 w-4 mr-2"}),p?"Uploading...":"Upload"]})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"font-semibold",children:"Uploaded Materials"}),f?e.jsx("div",{className:"space-y-2",children:[...Array(3)].map((a,t)=>e.jsx(M,{className:"h-12 w-full"},t))}):u.length===0?e.jsxs("div",{className:"text-center py-8 border rounded-lg",children:[e.jsx(q,{className:"h-8 w-8 mx-auto text-muted-foreground mb-2"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"No materials uploaded yet"})]}):e.jsx("div",{className:"space-y-2",children:u.map(a=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(q,{className:"h-5 w-5 text-primary"}),e.jsx("span",{className:"font-medium",children:a.file_name})]}),e.jsx(w,{variant:"ghost",size:"icon",onClick:()=>S(a),children:e.jsx(Y,{className:"h-4 w-4 text-destructive"})})]},a.id))})]})]})]})})},A=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],le=()=>{const{courseId:n}=O(),b=$(),{user:d}=L(),[r,_]=l.useState(null),[h,o]=l.useState([]),[u,y]=l.useState(!0),[f,N]=l.useState(null),[p,j]=l.useState(!1);l.useEffect(()=>{d&&n&&c()},[d,n]);const c=async()=>{if(!(!d||!n)){y(!0);try{const{data:s,error:i}=await g.from("courses").select("*, schedules(*)").eq("id",n).eq("teacher_id",d.id).single();if(i)throw i;_(s);const{data:S,error:a}=await g.from("enrollments").select("student_id, profiles(id, first_name, last_name)").eq("course_id",n);if(a)throw a;const t=S.map(m=>m.profiles).filter(Boolean);o(t)}catch(s){console.error("Error fetching course data:",s)}finally{y(!1)}}},v=s=>{N(s),j(!0)},x=s=>new Date(`2000-01-01T${s}`).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0});return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx("header",{className:"border-b bg-card",children:e.jsx("div",{className:"container mx-auto flex h-16 items-center justify-between px-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(w,{variant:"ghost",size:"icon",onClick:()=>b("/teacher/dashboard"),children:e.jsx(G,{className:"h-5 w-5"})}),e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:u?"Loading...":r==null?void 0:r.name})]})})}),e.jsx("main",{className:"container mx-auto p-6",children:e.jsxs("div",{className:"grid gap-6 lg:grid-cols-3",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsxs(C,{children:[e.jsxs(E,{children:[e.jsx(D,{children:"Enrolled Students"}),e.jsxs(T,{children:[h.length," students"]})]}),e.jsx(F,{children:u?e.jsx("div",{className:"space-y-2",children:[...Array(5)].map((s,i)=>e.jsx(M,{className:"h-10 w-full"},i))}):h.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(U,{className:"h-8 w-8 mx-auto text-muted-foreground mb-2"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"No students enrolled"})]}):e.jsx("div",{className:"space-y-2",children:h.map(s=>e.jsx("div",{className:"p-3 rounded-md border bg-card",children:e.jsxs("span",{className:"font-medium",children:[s.first_name," ",s.last_name]})},s.id))})})]})}),e.jsx("div",{className:"lg:col-span-2",children:e.jsxs(C,{children:[e.jsxs(E,{children:[e.jsx(D,{children:"Class Schedule & Materials"}),e.jsx(T,{children:"Weekly schedule for this course"})]}),e.jsx(F,{children:u?e.jsx("div",{className:"space-y-4",children:[...Array(3)].map((s,i)=>e.jsx(M,{className:"h-20 w-full"},i))}):!r||r.schedules.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(U,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"No schedule defined for this course"})]}):e.jsx("div",{className:"space-y-4",children:r.schedules.sort((s,i)=>s.day_of_week-i.day_of_week).map(s=>e.jsx("div",{className:"p-4 rounded-lg border bg-card space-y-3",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg",children:A[s.day_of_week]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[x(s.start_time)," - ",x(s.end_time)]})]}),e.jsxs(w,{onClick:()=>v(s),variant:"outline",size:"sm",children:[e.jsx(z,{className:"h-4 w-4 mr-2"}),"Manage Materials"]})]})},s.id))})})]})})]})}),f&&e.jsx(J,{open:p,onOpenChange:j,scheduleId:f.id,courseName:(r==null?void 0:r.name)||"",dayName:A[f.day_of_week]})]})};export{le as default};
