import{u as F,a as L,b as q,r as a,d as x,j as e}from"./index-BDmfLVIV.js";import{B as D}from"./button-C_eF5YE9.js";import{I as f}from"./input-DTTcDZLv.js";import{L as n}from"./label-C6-Qkfxd.js";import{C as T,a as A,b as B,c as P,d as _}from"./card-BjaUSfTE.js";import{S as p,a as j,b as g,c as N,d as o}from"./select-CDBSmjBr.js";import{G}from"./graduation-cap-BU25Nuyq.js";import"./Combination-DSrn1mx4.js";const Q=()=>{const m=F(),{user:s,loading:l}=L(),{toast:c}=q(),[u,h]=a.useState(!1),[v,y]=a.useState([]),[d,C]=a.useState(!0);a.useEffect(()=>{!l&&!s&&m("/login"),b()},[s,l,m]);const b=async()=>{try{const{data:t,error:r}=await x.from("institutions").select("id, name, type").order("name");if(r)throw r;y(t||[])}catch(t){console.error("Error fetching institutions:",t),c({title:"Error",description:"No se pudieron cargar las instituciones",variant:"destructive"})}finally{C(!1)}},I=async t=>{if(t.preventDefault(),!s)return;h(!0);const r=new FormData(t.currentTarget),w=r.get("firstName"),S=r.get("lastName"),R=r.get("role"),E=r.get("institutionId");try{const{error:i}=await x.from("profiles").insert({id:s.id,first_name:w,last_name:S,role:R,institution_id:E,email:s.email});if(i)throw i;c({title:"Éxito",description:"Registro completado correctamente."}),window.location.reload()}catch(i){c({title:"Error al completar registro",description:i.message||"No se pudo completar el registro",variant:"destructive"})}finally{h(!1)}};return l?e.jsx("div",{className:"flex min-h-screen items-center justify-center",children:e.jsx("div",{children:"Cargando..."})}):s?e.jsx("div",{className:"flex min-h-screen items-center justify-center bg-background p-4",children:e.jsxs("div",{className:"w-full max-w-md",children:[e.jsxs("div",{className:"mb-8 flex flex-col items-center",children:[e.jsx("div",{className:"mb-4 flex h-16 w-16 items-center justify-center rounded-2xl bg-primary",children:e.jsx(G,{className:"h-8 w-8 text-primary-foreground"})}),e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Academic Continuity"}),e.jsx("p",{className:"text-muted-foreground",children:"Complete your registration"})]}),e.jsxs(T,{children:[e.jsxs(A,{children:[e.jsx(B,{children:"Completar Registro"}),e.jsxs(P,{children:["Bienvenido ",s.email,". Por favor completa tu información para continuar."]})]}),e.jsx(_,{children:e.jsxs("form",{onSubmit:I,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"firstName",children:"Nombre"}),e.jsx(f,{id:"firstName",name:"firstName",placeholder:"Juan",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"lastName",children:"Apellido"}),e.jsx(f,{id:"lastName",name:"lastName",placeholder:"Pérez",required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"role",children:"Rol"}),e.jsxs(p,{name:"role",required:!0,children:[e.jsx(j,{children:e.jsx(g,{placeholder:"Selecciona tu rol"})}),e.jsxs(N,{children:[e.jsx(o,{value:"teacher",children:"Profesor"}),e.jsx(o,{value:"student",children:"Estudiante"}),e.jsx(o,{value:"representative",children:"Representante"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"institutionId",children:"Institución"}),e.jsxs(p,{name:"institutionId",required:!0,disabled:d,children:[e.jsx(j,{children:e.jsx(g,{placeholder:d?"Cargando...":"Selecciona tu institución"})}),e.jsx(N,{children:v.map(t=>e.jsx(o,{value:t.id,children:t.name},t.id))})]})]}),e.jsx(D,{type:"submit",className:"w-full",disabled:u||d,children:u?"Completando...":"Completar Registro"})]})})]})]})}):null};export{Q as default};
