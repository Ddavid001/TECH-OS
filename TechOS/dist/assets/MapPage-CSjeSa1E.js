import{d as B,u as E,e as T,r as t,f as L,j as e}from"./index-BioLNpht.js";import{u as z,a as D,I as U,N as V}from"./InteractiveMap-C5eX0OAU.js";import{C as g,d as y,a as A,b as G,c as P}from"./card-D2slsvxv.js";import{B as p}from"./button-CybwPT74.js";import{B as j}from"./badge-DzC7Yn4c.js";import{I as R}from"./input-BycZl0OU.js";import{S as F,a as H,b as O,c as $,d as n}from"./select-CCdqiMsy.js";import{S as q}from"./search-S6ZyGemg.js";import{M as J}from"./map-pin-D4HAWZ7E.js";import{B as K}from"./building-BAoWVeEE.js";import{G as Q}from"./graduation-cap-DsX5kety.js";import{B as W}from"./book-open-BYvQYvA9.js";import"./Combination-BBo_YeSU.js";import"./chevron-down-dB8tcOpH.js";const xe=()=>{const o=B(),{user:d,userRole:X}=E(),{toast:v}=T(),{markers:Y,isLoading:b}=z(),{setMapMarkers:f,setMapLoading:m}=D(),[x,w]=t.useState(""),[h,C]=t.useState("all"),[r,u]=t.useState(null),[S,k]=t.useState([]),N=t.useCallback(async()=>{try{m(!0);const{data:s,error:l}=await L.from("institutions").select("id, name, type, address, latitude, longitude").not("latitude","is",null).not("longitude","is",null);if(l)throw l;const c=(s||[]).map(a=>({id:a.id,name:a.name,type:a.type,latitude:a.latitude,longitude:a.longitude,address:a.address}));k(c),f(c)}catch(s){console.error("Error loading institutions:",s),v({title:"Error",description:"No se pudieron cargar las instituciones",variant:"destructive"})}finally{m(!1)}},[f,m,v]),i=S.filter(s=>{var a;const l=s.name.toLowerCase().includes(x.toLowerCase())||((a=s.address)==null?void 0:a.toLowerCase().includes(x.toLowerCase())),c=h==="all"||s.type===h;return l&&c}),I=t.useCallback(s=>{u(s)},[]),M=t.useCallback(s=>{u(s)},[]);return t.useEffect(()=>{N()},[N]),t.useEffect(()=>{d||o("/login")},[d,o]),d?e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white shadow-sm border-b",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex justify-between items-center h-16",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("h1",{className:"text-xl font-semibold text-gray-900",children:"Mapa de Instituciones"}),e.jsxs(j,{variant:"outline",className:"text-xs",children:[i.length," instituciones"]})]}),e.jsx("div",{className:"flex items-center space-x-4",children:e.jsx(p,{variant:"outline",onClick:()=>o("/dashboard"),children:"Volver al Dashboard"})})]})})}),e.jsxs("div",{className:"flex h-[calc(100vh-4rem)]",children:[e.jsx("div",{className:"w-80 bg-white border-r overflow-y-auto",children:e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx(q,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(R,{placeholder:"Buscar instituciones...",value:x,onChange:s=>w(s.target.value),className:"pl-10"})]}),e.jsxs(F,{value:h,onValueChange:s=>C(s),children:[e.jsx(H,{children:e.jsx(O,{placeholder:"Filtrar por tipo"})}),e.jsxs($,{children:[e.jsx(n,{value:"all",children:"Todos los tipos"}),e.jsx(n,{value:"school",children:"Escuelas"}),e.jsx(n,{value:"university",children:"Universidades"}),e.jsx(n,{value:"institute",children:"Institutos"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"Instituciones"}),b?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-primary"})}):i.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(J,{className:"h-8 w-8 mx-auto mb-2 text-gray-300"}),e.jsx("p",{children:"No se encontraron instituciones"})]}):i.map(s=>e.jsx(g,{className:`cursor-pointer transition-colors ${(r==null?void 0:r.id)===s.id?"ring-2 ring-primary":"hover:bg-gray-50"}`,onClick:()=>M(s),children:e.jsx(y,{className:"p-3",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsxs("div",{className:"flex-shrink-0",children:[s.type==="school"&&e.jsx(K,{className:"h-5 w-5 text-blue-500"}),s.type==="university"&&e.jsx(Q,{className:"h-5 w-5 text-purple-500"}),s.type==="institute"&&e.jsx(W,{className:"h-5 w-5 text-green-500"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-medium text-sm text-gray-900 truncate",children:s.name}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:s.address}),e.jsx(j,{variant:"secondary",className:"mt-2 text-xs",children:s.type==="school"?"Escuela":s.type==="university"?"Universidad":"Instituto"})]})]})})},s.id))]})]})}),e.jsx("div",{className:"flex-1",children:e.jsx(U,{markers:i,onMarkerClick:I,height:"100%"})})]}),r&&e.jsx("div",{className:"fixed bottom-4 left-4 right-4 z-30 max-w-md mx-auto",children:e.jsxs(g,{className:"bg-white shadow-lg",children:[e.jsx(A,{className:"pb-3",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx(G,{className:"text-lg",children:r.name}),e.jsx(P,{className:"text-sm",children:r.address})]}),e.jsx(p,{variant:"ghost",size:"sm",onClick:()=>u(null),children:"Ã—"})]})}),e.jsx(y,{className:"pt-0",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(j,{variant:"secondary",children:r.type==="school"?"Escuela":r.type==="university"?"Universidad":"Instituto"}),e.jsxs(p,{size:"sm",variant:"outline",children:[e.jsx(V,{className:"h-4 w-4 mr-2"}),"Direcciones"]})]})})]})})]}):null};export{xe as default};
