import{d as $,e as B,u as G,r as d,s as F,j as e}from"./index-BioLNpht.js";import{u as V,t as H}from"./types-eghP_0fx.js";import{T as E,u as L,t as q}from"./error-handler-B_W9GkVd.js";import{C as j,d as N,a as f,b as g,c as v}from"./card-D2slsvxv.js";import{B as x}from"./button-CybwPT74.js";import{I as p}from"./input-BycZl0OU.js";import{L as c}from"./label-UCsqN31L.js";import{C as z}from"./circle-check-big-BP5IeiCj.js";import{A as R}from"./arrow-left-BvZf5ZpO.js";import{G as J}from"./graduation-cap-DsX5kety.js";import{U as M}from"./upload-Bg1lXKuJ.js";import{F as _}from"./file-text-BJcmdsAo.js";const le=()=>{const o=$(),{toast:l}=B(),{user:r}=G(),{handleError:h}=L(),[b,y]=d.useState(!1),[m,P]=d.useState([]),[T,S]=d.useState(!1),{register:n,handleSubmit:A,formState:{errors:s},setValue:K,watch:D}=V({resolver:H(q),defaultValues:{email:(r==null?void 0:r.email)||""}});D("documents");const k=d.useCallback(async a=>{if(r)try{const i=Array.from(a).map(async u=>{const U=u.name.split(".").pop(),w=`teacher-applications/${`${r.id}/${Date.now()}.${U}`}`,{error:C}=await F.storage.from("applications").upload(w,u);if(C)throw C;return w}),t=await Promise.all(i);P(u=>[...u,...t]),l({title:"Archivos subidos",description:`${a.length} archivo(s) subido(s) correctamente`})}catch(i){const t=h(i,"FileUpload");l({title:"Error al subir archivos",description:t.message,variant:"destructive"})}},[r,l,h]),I=d.useCallback(async a=>{if(r){y(!0);try{const i={user_id:r.id,type:"teacher",status:"pending",data:{firstName:a.firstName,lastName:a.lastName,email:a.email,phone:a.phone,experience:a.experience,education:a.education},documents:m},{error:t}=await F.from("applications").insert(i);if(t)throw t;S(!0),l({title:"Postulación enviada",description:"Tu postulación ha sido enviada correctamente. Te contactaremos pronto."})}catch(i){const t=h(i,"TeacherApplication");l({title:"Error al enviar postulación",description:t.message,variant:"destructive"})}finally{y(!1)}}},[r,m,l,h]);return r?T?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx(j,{className:"max-w-md w-full mx-4",children:e.jsx(N,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx(z,{className:"h-16 w-16 text-green-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"¡Postulación Enviada!"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Tu postulación como docente ha sido enviada correctamente. Te contactaremos en 2-3 días hábiles."}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{onClick:()=>o("/applications"),className:"w-full",children:"Volver al Portal"}),e.jsx(x,{variant:"outline",onClick:()=>o("/dashboard"),className:"w-full",children:"Ir al Dashboard"})]})]})})})}):e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white shadow-sm border-b",children:e.jsx("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsx("div",{className:"flex justify-between items-center h-16",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs(x,{variant:"ghost",size:"sm",onClick:()=>o("/applications"),className:"mr-2",children:[e.jsx(R,{className:"h-4 w-4 mr-2"}),"Volver"]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(J,{className:"h-6 w-6 text-blue-600"}),e.jsx("h1",{className:"text-xl font-semibold text-gray-900",children:"Postulación como Docente"})]})]})})})}),e.jsx("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:e.jsxs("form",{onSubmit:A(I),className:"space-y-8",children:[e.jsxs(j,{children:[e.jsxs(f,{children:[e.jsx(g,{children:"Información Personal"}),e.jsx(v,{children:"Proporciona tu información personal básica"})]}),e.jsxs(N,{className:"space-y-4",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"firstName",children:"Nombre *"}),e.jsx(p,{id:"firstName",...n("firstName"),placeholder:"Tu nombre"}),s.firstName&&e.jsx("p",{className:"text-sm text-red-600",children:s.firstName.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"lastName",children:"Apellido *"}),e.jsx(p,{id:"lastName",...n("lastName"),placeholder:"Tu apellido"}),s.lastName&&e.jsx("p",{className:"text-sm text-red-600",children:s.lastName.message})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"email",children:"Email *"}),e.jsx(p,{id:"email",type:"email",...n("email"),placeholder:"tu@email.com"}),s.email&&e.jsx("p",{className:"text-sm text-red-600",children:s.email.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"phone",children:"Teléfono"}),e.jsx(p,{id:"phone",...n("phone"),placeholder:"+58 412 123 4567"}),s.phone&&e.jsx("p",{className:"text-sm text-red-600",children:s.phone.message})]})]})]})]}),e.jsxs(j,{children:[e.jsxs(f,{children:[e.jsx(g,{children:"Información Profesional"}),e.jsx(v,{children:"Comparte tu experiencia y formación académica"})]}),e.jsxs(N,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"education",children:"Formación Académica"}),e.jsx(E,{id:"education",...n("education"),placeholder:"Describe tu formación académica, títulos, certificaciones...",rows:3}),s.education&&e.jsx("p",{className:"text-sm text-red-600",children:s.education.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"experience",children:"Experiencia Docente"}),e.jsx(E,{id:"experience",...n("experience"),placeholder:"Describe tu experiencia como docente, materias que impartes, años de experiencia...",rows:3}),s.experience&&e.jsx("p",{className:"text-sm text-red-600",children:s.experience.message})]})]})]}),e.jsxs(j,{children:[e.jsxs(f,{children:[e.jsx(g,{children:"Documentos Requeridos"}),e.jsx(v,{children:"Sube los documentos necesarios para tu postulación"})]}),e.jsxs(N,{className:"space-y-4",children:[e.jsx("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx(M,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(c,{htmlFor:"documents",className:"cursor-pointer",children:[e.jsx("span",{className:"text-blue-600 hover:text-blue-500",children:"Haz clic para subir archivos"}),e.jsx("span",{className:"text-gray-500",children:" o arrastra y suelta"})]}),e.jsx(p,{id:"documents",type:"file",multiple:!0,accept:".pdf,.jpg,.jpeg,.png",onChange:a=>{a.target.files&&k(a.target.files)},className:"hidden"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Formatos permitidos: PDF, JPG, PNG (máx. 5MB por archivo)"})]})]})}),m.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Archivos subidos:"}),e.jsx("div",{className:"space-y-1",children:m.map((a,i)=>e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-600",children:[e.jsx(_,{className:"h-4 w-4"}),e.jsx("span",{children:a.split("/").pop()})]},i))})]}),s.documents&&e.jsx("p",{className:"text-sm text-red-600",children:s.documents.message})]})]}),e.jsxs("div",{className:"flex justify-end space-x-4",children:[e.jsx(x,{type:"button",variant:"outline",onClick:()=>o("/applications"),children:"Cancelar"}),e.jsx(x,{type:"submit",disabled:b||m.length===0,children:b?"Enviando...":"Enviar Postulación"})]})]})})]}):(o("/login"),null)};export{le as default};
