import{d as L,b as G,u as M,e as k,r as l,j as e,L as q,s as v}from"./index-BioLNpht.js";import{B as b}from"./button-CybwPT74.js";import{I as N}from"./input-BycZl0OU.js";import{L as w}from"./label-UCsqN31L.js";import{C as D,a as T,b as A,c as B,d as P}from"./card-D2slsvxv.js";import{G as S}from"./graduation-cap-DsX5kety.js";import{C as F}from"./circle-check-big-BP5IeiCj.js";const z=()=>{const g=L(),c=G(),{user:x,userRole:d,loading:y}=M(),{toast:m}=k(),[u,o]=l.useState(!1),[h,C]=l.useState(null);l.useEffect(()=>{var s;(s=c.state)!=null&&s.message&&C(c.state.message)},[c.state]),l.useEffect(()=>{if(x){const i=d?{admin:"/admin/dashboard",teacher:"/teacher/dashboard",student:"/student/dashboard",representative:"/representative/dashboard"}[d]:"/profile";g(i,{replace:!0})}},[x,d,g]);const E=async s=>{var f,p,j;s.preventDefault(),o(!0);const i=new FormData(s.currentTarget),t=i.get("login-email"),a=i.get("login-password");try{const{data:n,error:r}=await v.auth.signInWithPassword({email:t,password:a});if(r)throw console.error("Error de autenticación:",r),r;m({title:"Éxito",description:"Has iniciado sesión correctamente."})}catch(n){console.error("Error completo en login:",n);let r="Error al intentar iniciar sesión";(f=n.message)!=null&&f.includes("Invalid login credentials")?r="Credenciales incorrectas. Verifica tu email y contraseña.":(p=n.message)!=null&&p.includes("Email not confirmed")?r="Por favor confirma tu email antes de iniciar sesión.":(j=n.message)!=null&&j.includes("Too many requests")?r="Demasiados intentos. Espera un momento antes de intentar nuevamente.":n.message&&(r=n.message),m({title:"Error de inicio de sesión",description:r,variant:"destructive"})}finally{o(!1)}},I=async()=>{var s,i;try{o(!0);const{data:t,error:a}=await v.auth.signInWithOAuth({provider:"google",options:{redirectTo:`${window.location.origin}/auth/callback`}});if(a)throw a}catch(t){console.error("Error completo en Google login:",t);let a="No se pudo iniciar sesión con Google";(s=t.message)!=null&&s.includes("popup_blocked")?a="El navegador bloqueó la ventana emergente. Permite ventanas emergentes para este sitio.":(i=t.message)!=null&&i.includes("access_denied")?a="Acceso denegado. Intenta nuevamente.":t.message&&(a=t.message),m({title:"Error de Google",description:a,variant:"destructive"})}finally{o(!1)}};return y?e.jsx("div",{className:"flex min-h-screen items-center justify-center",children:e.jsx("div",{children:"Cargando..."})}):e.jsx("div",{className:"flex min-h-screen items-center justify-center bg-background p-4",children:e.jsxs("div",{className:"w-full max-w-md",children:[e.jsxs("div",{className:"mb-8 flex flex-col items-center",children:[e.jsx("div",{className:"mb-4 flex h-16 w-16 items-center justify-center rounded-2xl bg-primary",children:e.jsx(S,{className:"h-8 w-8 text-primary-foreground"})}),e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Academic Continuity"}),e.jsx("p",{className:"text-muted-foreground",children:"Platform for Education Management"})]}),e.jsxs(D,{children:[e.jsxs(T,{children:[e.jsx(A,{children:"Bienvenido"}),e.jsx(B,{children:"Inicia sesión en tu cuenta"})]}),e.jsxs(P,{children:[h&&e.jsx("div",{className:"mb-4 rounded-lg bg-green-50 p-4 border border-green-200",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(F,{className:"h-5 w-5 text-green-600 mr-2"}),e.jsx("p",{className:"text-sm text-green-800",children:h})]})}),e.jsxs("form",{onSubmit:E,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"login-email",children:"Email"}),e.jsx(N,{id:"login-email",name:"login-email",type:"email",placeholder:"tu@ejemplo.com",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"login-password",children:"Contraseña"}),e.jsx(N,{id:"login-password",name:"login-password",type:"password",placeholder:"••••••••",required:!0})]}),e.jsx(b,{type:"submit",className:"w-full",disabled:u,children:u?"Iniciando sesión...":"Iniciar Sesión"})]}),e.jsxs("div",{className:"my-4 flex items-center",children:[e.jsx("div",{className:"flex-grow border-t border-muted"}),e.jsx("span",{className:"mx-4 text-xs uppercase text-muted-foreground",children:"O"}),e.jsx("div",{className:"flex-grow border-t border-muted"})]}),e.jsxs(b,{variant:"outline",className:"w-full",onClick:I,disabled:u,children:[e.jsx("span",{className:"mr-2 h-5 w-5",children:"G"}),"Continuar con Google"]}),e.jsx("div",{className:"mt-4 text-center",children:e.jsxs("p",{className:"text-sm text-muted-foreground",children:["¿No tienes cuenta?"," ",e.jsx(q,{to:"/register",className:"text-primary hover:underline",children:"Regístrate aquí"})]})})]})]})]})})};export{z as default};
