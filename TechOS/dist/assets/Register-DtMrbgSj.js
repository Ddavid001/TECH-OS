import{d as A,u as D,e as M,r as n,f as z,j as e,L as B,s as j}from"./index-BioLNpht.js";import{B as g}from"./button-CybwPT74.js";import{I as o}from"./input-BycZl0OU.js";import{L as a}from"./label-UCsqN31L.js";import{C as O,a as H,b as J,c as V,d as W}from"./card-D2slsvxv.js";import{S as v,a as N,b as y,c as w,d as c}from"./select-CCdqiMsy.js";import{G as Y}from"./graduation-cap-DsX5kety.js";import"./Combination-BBo_YeSU.js";import"./chevron-down-dB8tcOpH.js";const re=()=>{const l=A(),{user:x,userRole:d,loading:b}=D(),{toast:t}=M(),[m,i]=n.useState(!1),[C,I]=n.useState([]),[u,E]=n.useState(!0);n.useEffect(()=>{if(x){const r=d?{admin:"/admin/dashboard",teacher:"/teacher/dashboard",student:"/student/dashboard",representative:"/representative/dashboard"}[d]:"/profile";l(r,{replace:!0})}},[x,d,l]),n.useEffect(()=>{S()},[]);const S=async()=>{try{const{data:s,error:r}=await z.from("institutions").select("id, name, type").order("name");if(r)throw r;I(s||[])}catch(s){console.error("Error fetching institutions:",s),t({title:"Error",description:"No se pudieron cargar las instituciones",variant:"destructive"})}finally{E(!1)}},L=async s=>{s.preventDefault(),i(!0);const r=new FormData(s.currentTarget),F=r.get("email"),h=r.get("password"),R=r.get("confirmPassword"),q=r.get("firstName"),G=r.get("lastName"),T=r.get("role"),k=r.get("institutionId");if(h!==R){t({title:"Error",description:"Las contraseñas no coinciden",variant:"destructive"}),i(!1);return}if(h.length<6){t({title:"Error",description:"La contraseña debe tener al menos 6 caracteres",variant:"destructive"}),i(!1);return}try{const{data:p,error:f}=await j.functions.invoke("create-user",{body:{email:F,password:h,firstName:q,lastName:G,role:T,institutionId:k}});if(f)throw f;t({title:"Éxito",description:"Cuenta creada correctamente. Se ha enviado un correo de confirmación a tu email."}),l("/login",{state:{message:"Por favor, revisa tu correo y haz clic en el enlace de confirmación para activar tu cuenta."}})}catch(p){t({title:"Error al registrar",description:p.message||"No se pudo crear la cuenta",variant:"destructive"})}finally{i(!1)}},P=async()=>{i(!0);try{const{error:s}=await j.auth.signInWithOAuth({provider:"google",options:{redirectTo:`${window.location.origin}/complete-registration`}});if(s)throw s}catch(s){t({title:"Error de Google",description:s.message||"No se pudo registrar con Google.",variant:"destructive"})}finally{i(!1)}};return b?e.jsx("div",{className:"flex min-h-screen items-center justify-center",children:e.jsx("div",{children:"Cargando..."})}):e.jsx("div",{className:"flex min-h-screen items-center justify-center bg-background p-4",children:e.jsxs("div",{className:"w-full max-w-md",children:[e.jsxs("div",{className:"mb-8 flex flex-col items-center",children:[e.jsx("div",{className:"mb-4 flex h-16 w-16 items-center justify-center rounded-2xl bg-primary",children:e.jsx(Y,{className:"h-8 w-8 text-primary-foreground"})}),e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Academic Continuity"}),e.jsx("p",{className:"text-muted-foreground",children:"Platform for Education Management"})]}),e.jsxs(O,{children:[e.jsxs(H,{children:[e.jsx(J,{children:"Crear Cuenta"}),e.jsx(V,{children:"Regístrate para acceder a la plataforma"})]}),e.jsxs(W,{children:[e.jsxs("form",{onSubmit:L,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{htmlFor:"firstName",children:"Nombre"}),e.jsx(o,{id:"firstName",name:"firstName",placeholder:"Juan",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{htmlFor:"lastName",children:"Apellido"}),e.jsx(o,{id:"lastName",name:"lastName",placeholder:"Pérez",required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{htmlFor:"email",children:"Email"}),e.jsx(o,{id:"email",name:"email",type:"email",placeholder:"juan@ejemplo.com",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{htmlFor:"role",children:"Rol"}),e.jsxs(v,{name:"role",required:!0,children:[e.jsx(N,{children:e.jsx(y,{placeholder:"Selecciona tu rol"})}),e.jsxs(w,{children:[e.jsx(c,{value:"teacher",children:"Profesor"}),e.jsx(c,{value:"student",children:"Estudiante"}),e.jsx(c,{value:"representative",children:"Representante"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{htmlFor:"institutionId",children:"Institución"}),e.jsxs(v,{name:"institutionId",required:!0,disabled:u,children:[e.jsx(N,{children:e.jsx(y,{placeholder:u?"Cargando...":"Selecciona tu institución"})}),e.jsx(w,{children:C.map(s=>e.jsx(c,{value:s.id,children:s.name},s.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{htmlFor:"password",children:"Contraseña"}),e.jsx(o,{id:"password",name:"password",type:"password",placeholder:"••••••••",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(a,{htmlFor:"confirmPassword",children:"Confirmar Contraseña"}),e.jsx(o,{id:"confirmPassword",name:"confirmPassword",type:"password",placeholder:"••••••••",required:!0})]}),e.jsx(g,{type:"submit",className:"w-full",disabled:m||u,children:m?"Creando cuenta...":"Crear Cuenta"})]}),e.jsxs("div",{className:"my-4 flex items-center",children:[e.jsx("div",{className:"flex-grow border-t border-muted"}),e.jsx("span",{className:"mx-4 text-xs uppercase text-muted-foreground",children:"O"}),e.jsx("div",{className:"flex-grow border-t border-muted"})]}),e.jsxs(g,{variant:"outline",className:"w-full",onClick:P,disabled:m,children:[e.jsx("span",{className:"mr-2 h-5 w-5",children:"G"}),"Continuar con Google"]}),e.jsx("div",{className:"mt-4 text-center",children:e.jsxs("p",{className:"text-sm text-muted-foreground",children:["¿Ya tienes cuenta?"," ",e.jsx(B,{to:"/login",className:"text-primary hover:underline",children:"Inicia sesión"})]})})]})]})]})})};export{re as default};
