import{u as q,e as O,r as l,f as g,j as e,s as E,k as $,d as z}from"./index-BioLNpht.js";import{B as w}from"./button-CybwPT74.js";import{C as M,a as D,b as k,c as T,d as F}from"./card-D2slsvxv.js";import{S as C}from"./skeleton-DApMEAu8.js";import{D as H,a as P,b as W,c as I,d as R,T as Y}from"./dialog-QflogPSs.js";import{I as G}from"./input-BycZl0OU.js";import{U as B}from"./upload-Bg1lXKuJ.js";import{F as U}from"./file-text-BJcmdsAo.js";import{A as J}from"./arrow-left-BvZf5ZpO.js";import{B as A}from"./book-open-BYvQYvA9.js";import"./Combination-BBo_YeSU.js";const K=({open:o,onOpenChange:_,scheduleId:n,courseName:t,dayName:b})=>{const{user:h}=q(),{toast:d}=O(),[u,N]=l.useState([]),[f,y]=l.useState(!1),[p,j]=l.useState(!1),[c,v]=l.useState(null);l.useEffect(()=>{o&&x()},[o,n]);const x=async()=>{y(!0);try{const{data:a,error:r}=await g.from("class_materials").select("*").eq("schedule_id",n).order("created_at",{ascending:!1});if(r)throw r;N(a||[])}catch(a){console.error("Error fetching materials:",a),d({title:"Error",description:"Failed to load materials",variant:"destructive"})}finally{y(!1)}},s=a=>{a.target.files&&a.target.files[0]&&v(a.target.files[0])},i=async()=>{if(!(!c||!h)){j(!0);try{const a=`${n}/${Date.now()}_${c.name}`,{error:r}=await E.storage.from("class-materials").upload(a,c);if(r)throw r;const{error:m}=await g.from("class_materials").insert({schedule_id:n,file_name:c.name,file_path:a,uploaded_by:h.id});if(m)throw m;d({title:"Success",description:"Material uploaded successfully"}),v(null),x()}catch(a){console.error("Error uploading material:",a),d({title:"Error",description:"Failed to upload material",variant:"destructive"})}finally{j(!1)}}},S=async a=>{try{const{error:r}=await E.storage.from("class-materials").remove([a.file_path]);if(r)throw r;const{error:m}=await g.from("class_materials").delete().eq("id",a.id);if(m)throw m;d({title:"Success",description:"Material deleted successfully"}),x()}catch(r){console.error("Error deleting material:",r),d({title:"Error",description:"Failed to delete material",variant:"destructive"})}};return e.jsx(H,{open:o,onOpenChange:_,children:e.jsxs(P,{className:"max-w-2xl",children:[e.jsxs(W,{children:[e.jsx(I,{children:"Manage Materials"}),e.jsxs(R,{children:[t," - ",b]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(G,{type:"file",onChange:s,disabled:p}),e.jsxs(w,{onClick:i,disabled:!c||p,children:[e.jsx(B,{className:"h-4 w-4 mr-2"}),p?"Uploading...":"Upload"]})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"font-semibold",children:"Uploaded Materials"}),f?e.jsx("div",{className:"space-y-2",children:[...Array(3)].map((a,r)=>e.jsx(C,{className:"h-12 w-full"},r))}):u.length===0?e.jsxs("div",{className:"text-center py-8 border rounded-lg",children:[e.jsx(U,{className:"h-8 w-8 mx-auto text-muted-foreground mb-2"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"No materials uploaded yet"})]}):e.jsx("div",{className:"space-y-2",children:u.map(a=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(U,{className:"h-5 w-5 text-primary"}),e.jsx("span",{className:"font-medium",children:a.file_name})]}),e.jsx(w,{variant:"ghost",size:"icon",onClick:()=>S(a),children:e.jsx(Y,{className:"h-4 w-4 text-destructive"})})]},a.id))})]})]})]})})},L=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],oe=()=>{const{courseId:o}=$(),_=z(),{user:n}=q(),[t,b]=l.useState(null),[h,d]=l.useState([]),[u,N]=l.useState(!0),[f,y]=l.useState(null),[p,j]=l.useState(!1);l.useEffect(()=>{n&&o&&c()},[n,o]);const c=async()=>{if(!(!n||!o)){N(!0);try{const{data:s,error:i}=await g.from("courses").select("*, schedules(*)").eq("id",o).eq("teacher_id",n.id).single();if(i)throw i;b(s);const{data:S,error:a}=await g.from("enrollments").select("student_id, profiles(id, first_name, last_name)").eq("course_id",o);if(a)throw a;const r=S.map(m=>m.profiles).filter(Boolean);d(r)}catch(s){console.error("Error fetching course data:",s)}finally{N(!1)}}},v=s=>{y(s),j(!0)},x=s=>new Date(`2000-01-01T${s}`).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0});return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx("header",{className:"border-b bg-card",children:e.jsx("div",{className:"container mx-auto flex h-16 items-center justify-between px-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(w,{variant:"ghost",size:"icon",onClick:()=>_("/teacher/dashboard"),children:e.jsx(J,{className:"h-5 w-5"})}),e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:u?"Loading...":t==null?void 0:t.name})]})})}),e.jsx("main",{className:"container mx-auto p-6",children:e.jsxs("div",{className:"grid gap-6 lg:grid-cols-3",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsxs(M,{children:[e.jsxs(D,{children:[e.jsx(k,{children:"Enrolled Students"}),e.jsxs(T,{children:[h.length," students"]})]}),e.jsx(F,{children:u?e.jsx("div",{className:"space-y-2",children:[...Array(5)].map((s,i)=>e.jsx(C,{className:"h-10 w-full"},i))}):h.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(A,{className:"h-8 w-8 mx-auto text-muted-foreground mb-2"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"No students enrolled"})]}):e.jsx("div",{className:"space-y-2",children:h.map(s=>e.jsx("div",{className:"p-3 rounded-md border bg-card",children:e.jsxs("span",{className:"font-medium",children:[s.first_name," ",s.last_name]})},s.id))})})]})}),e.jsx("div",{className:"lg:col-span-2",children:e.jsxs(M,{children:[e.jsxs(D,{children:[e.jsx(k,{children:"Class Schedule & Materials"}),e.jsx(T,{children:"Weekly schedule for this course"})]}),e.jsx(F,{children:u?e.jsx("div",{className:"space-y-4",children:[...Array(3)].map((s,i)=>e.jsx(C,{className:"h-20 w-full"},i))}):!t||t.schedules.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(A,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"No schedule defined for this course"})]}):e.jsx("div",{className:"space-y-4",children:t.schedules.sort((s,i)=>s.day_of_week-i.day_of_week).map(s=>e.jsx("div",{className:"p-4 rounded-lg border bg-card space-y-3",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg",children:L[s.day_of_week]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[x(s.start_time)," - ",x(s.end_time)]})]}),e.jsxs(w,{onClick:()=>v(s),variant:"outline",size:"sm",children:[e.jsx(B,{className:"h-4 w-4 mr-2"}),"Manage Materials"]})]})},s.id))})})]})})]})}),f&&e.jsx(K,{open:p,onOpenChange:j,scheduleId:f.id,courseName:(t==null?void 0:t.name)||"",dayName:L[f.day_of_week]})]})};export{oe as default};
