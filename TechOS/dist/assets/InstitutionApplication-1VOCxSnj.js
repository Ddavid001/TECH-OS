import{d as V,e as $,u as L,r as m,s as P,j as e}from"./index-BioLNpht.js";import{u as R,t as H}from"./types-eghP_0fx.js";import{T as q,u as z,i as G}from"./error-handler-B_W9GkVd.js";import{C as j,d as N,a as f,b as g,c as v}from"./card-D2slsvxv.js";import{B as x}from"./button-CybwPT74.js";import{I as p}from"./input-BycZl0OU.js";import{L as r}from"./label-UCsqN31L.js";import{S as J,a as M,b as _,c as K,d as y}from"./select-CCdqiMsy.js";import{C as O}from"./circle-check-big-BP5IeiCj.js";import{A as Q}from"./arrow-left-BvZf5ZpO.js";import{B as W}from"./building-BAoWVeEE.js";import{U as X}from"./upload-Bg1lXKuJ.js";import{F as Y}from"./file-text-BJcmdsAo.js";import"./Combination-BBo_YeSU.js";import"./chevron-down-dB8tcOpH.js";const ue=()=>{const l=V(),{toast:n}=$(),{user:t}=L(),{handleError:h}=z(),[b,C]=m.useState(!1),[o,S]=m.useState([]),[F,I]=m.useState(!1),{register:d,handleSubmit:T,formState:{errors:a},setValue:D,watch:A}=R({resolver:H(G),defaultValues:{contactEmail:(t==null?void 0:t.email)||""}});A("documents");const k=m.useCallback(async s=>{if(t)try{const i=Array.from(s).map(async u=>{const U=u.name.split(".").pop(),w=`institution-applications/${`${t.id}/${Date.now()}.${U}`}`,{error:E}=await P.storage.from("applications").upload(w,u);if(E)throw E;return w}),c=await Promise.all(i);S(u=>[...u,...c]),n({title:"Archivos subidos",description:`${s.length} archivo(s) subido(s) correctamente`})}catch(i){const c=h(i,"FileUpload");n({title:"Error al subir archivos",description:c.message,variant:"destructive"})}},[t,n,h]),B=m.useCallback(async s=>{if(t){C(!0);try{const i={user_id:t.id,type:"institution",status:"pending",data:{name:s.name,type:s.type,address:s.address,contactName:s.contactName,contactEmail:s.contactEmail,contactPhone:s.contactPhone},documents:o},{error:c}=await P.from("applications").insert(i);if(c)throw c;I(!0),n({title:"Postulación enviada",description:"Tu postulación de institución ha sido enviada correctamente. Te contactaremos pronto."})}catch(i){const c=h(i,"InstitutionApplication");n({title:"Error al enviar postulación",description:c.message,variant:"destructive"})}finally{C(!1)}}},[t,o,n,h]);return t?F?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx(j,{className:"max-w-md w-full mx-4",children:e.jsx(N,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx(O,{className:"h-16 w-16 text-green-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"¡Postulación Enviada!"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Tu postulación de institución ha sido enviada correctamente. Te contactaremos en 2-3 días hábiles."}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{onClick:()=>l("/applications"),className:"w-full",children:"Volver al Portal"}),e.jsx(x,{variant:"outline",onClick:()=>l("/dashboard"),className:"w-full",children:"Ir al Dashboard"})]})]})})})}):e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white shadow-sm border-b",children:e.jsx("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsx("div",{className:"flex justify-between items-center h-16",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs(x,{variant:"ghost",size:"sm",onClick:()=>l("/applications"),className:"mr-2",children:[e.jsx(Q,{className:"h-4 w-4 mr-2"}),"Volver"]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(W,{className:"h-6 w-6 text-green-600"}),e.jsx("h1",{className:"text-xl font-semibold text-gray-900",children:"Postulación de Institución"})]})]})})})}),e.jsx("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:e.jsxs("form",{onSubmit:T(B),className:"space-y-8",children:[e.jsxs(j,{children:[e.jsxs(f,{children:[e.jsx(g,{children:"Información de la Institución"}),e.jsx(v,{children:"Proporciona los datos básicos de tu institución educativa"})]}),e.jsxs(N,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"name",children:"Nombre de la Institución *"}),e.jsx(p,{id:"name",...d("name"),placeholder:"Nombre oficial de la institución"}),a.name&&e.jsx("p",{className:"text-sm text-red-600",children:a.name.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"type",children:"Tipo de Institución *"}),e.jsxs(J,{onValueChange:s=>D("type",s),children:[e.jsx(M,{children:e.jsx(_,{placeholder:"Selecciona el tipo de institución"})}),e.jsxs(K,{children:[e.jsx(y,{value:"school",children:"Escuela"}),e.jsx(y,{value:"university",children:"Universidad"}),e.jsx(y,{value:"institute",children:"Instituto"})]})]}),a.type&&e.jsx("p",{className:"text-sm text-red-600",children:a.type.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"address",children:"Dirección *"}),e.jsx(q,{id:"address",...d("address"),placeholder:"Dirección completa de la institución",rows:3}),a.address&&e.jsx("p",{className:"text-sm text-red-600",children:a.address.message})]})]})]}),e.jsxs(j,{children:[e.jsxs(f,{children:[e.jsx(g,{children:"Información de Contacto"}),e.jsx(v,{children:"Datos de la persona responsable de la institución"})]}),e.jsxs(N,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"contactName",children:"Nombre del Contacto *"}),e.jsx(p,{id:"contactName",...d("contactName"),placeholder:"Nombre completo del responsable"}),a.contactName&&e.jsx("p",{className:"text-sm text-red-600",children:a.contactName.message})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"contactEmail",children:"Email de Contacto *"}),e.jsx(p,{id:"contactEmail",type:"email",...d("contactEmail"),placeholder:"contacto@institucion.com"}),a.contactEmail&&e.jsx("p",{className:"text-sm text-red-600",children:a.contactEmail.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"contactPhone",children:"Teléfono de Contacto"}),e.jsx(p,{id:"contactPhone",...d("contactPhone"),placeholder:"+58 212 123 4567"}),a.contactPhone&&e.jsx("p",{className:"text-sm text-red-600",children:a.contactPhone.message})]})]})]})]}),e.jsxs(j,{children:[e.jsxs(f,{children:[e.jsx(g,{children:"Documentos Requeridos"}),e.jsx(v,{children:"Sube los documentos legales de la institución"})]}),e.jsxs(N,{className:"space-y-4",children:[e.jsx("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx(X,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(r,{htmlFor:"documents",className:"cursor-pointer",children:[e.jsx("span",{className:"text-blue-600 hover:text-blue-500",children:"Haz clic para subir archivos"}),e.jsx("span",{className:"text-gray-500",children:" o arrastra y suelta"})]}),e.jsx(p,{id:"documents",type:"file",multiple:!0,accept:".pdf,.jpg,.jpeg,.png",onChange:s=>{s.target.files&&k(s.target.files)},className:"hidden"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Formatos permitidos: PDF, JPG, PNG (máx. 5MB por archivo)"}),e.jsx("p",{className:"text-xs text-gray-400",children:"Documentos requeridos: RIF, Registro de Comercio, Licencias educativas"})]})]})}),o.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Archivos subidos:"}),e.jsx("div",{className:"space-y-1",children:o.map((s,i)=>e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-600",children:[e.jsx(Y,{className:"h-4 w-4"}),e.jsx("span",{children:s.split("/").pop()})]},i))})]}),a.documents&&e.jsx("p",{className:"text-sm text-red-600",children:a.documents.message})]})]}),e.jsxs("div",{className:"flex justify-end space-x-4",children:[e.jsx(x,{type:"button",variant:"outline",onClick:()=>l("/applications"),children:"Cancelar"}),e.jsx(x,{type:"submit",disabled:b||o.length===0,children:b?"Enviando...":"Enviar Postulación"})]})]})})]}):(l("/login"),null)};export{ue as default};
